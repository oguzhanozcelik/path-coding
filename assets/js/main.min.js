$(document).ready((function(){setTimeout((function(){$(".lazy").each((function(){$(this).attr("src",$(this).attr("data-src")).addClass("lazyloaded")}))}),1e3),$(window).scroll((function(){$(".lazy").each((function(){$(this).offset().top<$(window).scrollTop()+$(window).height()+100&&$(this).attr("src",$(this).attr("data-src")).addClass("lazyloaded")}))}));let t=JSON.parse(localStorage.getItem("cart"));$(".item-total-quantity").empty().append(t.length);let a={title:"batman",limit:10,page:0};function e(t,a,e=0){let s="",i=JSON.parse(localStorage.getItem("favorites")),o=[];if(null!==i?i.map((function(t){o.push(t.productId)})):i=[],0===e)$.ajax({type:"GET",url:"https://www.cheapshark.com/api/1.0/games?title="+t+"&exact=0",dataType:"json",success:function(t){t&&(localStorage.setItem("games",JSON.stringify(t)),t.map((function(t,a){let e=t.gameID,i=t.thumb,d=t.cheapest,c=t.cheapestDealID,r=t.external;t.internalName;r.length>25&&(r=r.slice(0,22)+"..."),a<10&&(s+='<div class="card product">                <div class="row g-0">                    <div class="col-md-4 product-image">                        <img src="assets/images/loading.svg" data-src="'+i+'" class="img-fluid rounded-start lazy" alt="'+r+'"/>                    </div>                    <div class="col-md-8">                        <div class="card-body">',o.includes(e)?s+='                           <h4 class="card-title">'+r+' <span class="favorited">Added to favorites<img src="assets/images/heart.svg" alt="Added to favorites"/></span></h4>':s+='                           <h4 class="card-title">'+r+' <span class="add-to-favorites" data-product-id="'+e+'" data-name="'+t.external+'" data-image="'+i+'">Add<img src="assets/images/heart.svg" alt="Add to favorites"/></span></h4>',s+='                           <div class="price-section">                              <span class="cheapest-price">Cheapest Price: <b>$'+d+'</b></span>                            </div>                           <div class="actions mt-3">                               <button class="btn btn-danger quick-view" data-toggle="modal" data-target="#gameModal" data-product-id="'+e+'" data-cheapest="'+c+'"><img src="assets/images/quick.svg" alt="Add to favorites"/> Quick View</button>                           </div>                            </div>                    </div>                </div>            </div>')})),$("#products").append(s))},error:function(t){console.log("-> err",t)}});else{var d=JSON.parse(localStorage.getItem("games"));let t=a*e,i=a+a*e;d.map((function(a,e){let d=a.gameID,c=a.thumb,r=a.cheapest,l=a.cheapestDealID,n=a.external;a.internalName;n.length>25&&(n=n.slice(0,22)+"..."),e>t-1&&e<i&&(s+='<div class="card product" style="">                <div class="row g-0">                    <div class="col-md-4 product-image">                        <img src="assets/images/loading.svg" data-src="'+c+'" class="img-fluid rounded-start lazy" alt="'+n+'"/>                    </div>                    <div class="col-md-8">                        <div class="card-body">',o.includes(d)?s+='                           <h4 class="card-title">'+n+' <span class="favorited">Added to favorites<img src="assets/images/heart.svg" alt="Added to favorites"/></span></h4>':s+='                           <h4 class="card-title">'+n+' <span class="add-to-favorites" data-product-id="'+d+'" data-name="'+a.external+'" data-image="'+c+'">Add<img src="assets/images/heart.svg" alt="Add to favorites"/></span></h4>',s+='                           <div class="price-section">                              <span class="cheapest-price">Cheapest Price: <b>$'+r+'</b></span>                            </div>                           <div class="actions mt-3">                               <button class="btn btn-danger quick-view" data-toggle="modal" data-target="#gameModal" data-product-id="'+d+'" data-cheapest="'+l+'"><img src="assets/images/quick.svg" alt="Add to favorites"/> Quick View</button>                           </div>                            </div>                    </div>                </div>            </div>')})),$("#products").append(s)}}function s(t,a){$(".toast-title").empty().append(t),$(".toast-body").empty().append(a),$(".toast").toast("show"),setTimeout((function(){$(".toast").toast("hide")}),3e3)}function i(){const t=JSON.parse(localStorage.getItem("cart"));let a="",e=0;if(null!==t&&0!==t.length){let s=[];t.map((function(i,o){var d={};if(e+=Number(i.price),!s.includes(i.productId)){for(var c=0;c<t.length;c++)d[t[c].productId]=1+(d[t[c].productId]||0);let e=(Number(i.price)*d[i.productId]).toFixed(2);a+='<div class="card-body">              <div class="d-flex justify-content-between">                <div class="d-flex flex-row align-items-center">              <div>                  <img src="'+i.image+'" class="img-fluid rounded-3" alt="Shopping item" style="width: 65px;">               </div>               <div class="ms-3">                  <h5>'+i.title+'</h5>               </div>           </div>           <div class="d-flex flex-row align-items-center">               <div style="width: 50px;">                   <p class="fw-normal mb-0">x'+d[i.productId]+'</p>               </div>               <div style="width: 80px;text-align: left;">                  <p class="mb-0">$'+i.price+"</p>                </div>",d[i.productId]>1?a+='               <div style="width: 80px;text-align: left;">                  <p class="mb-0">$'+e+"</p>                </div>":a+='<div style="width: 80px;">                  <p class="mb-0">&nbsp;</p>           </div>',a+='               <div style="width: 25px;">                  <p class="mb-0"><img src="assets/images/cancel.svg" data-id="'+i.productId+'" class="remove-item"  alt="Remove Item"/> </p>                </div>',a+="               </div>           </div>            </div>"}s.push(i.productId)})),$(".total-price").empty().append("$"+e.toFixed(2)).show(),$(".total-items").show(),$(".shopping-list").empty().html(a)}else $(".total-price").empty().hide(),$(".total-items").hide(),$(".shopping-list").empty().html("<b>You have no products in your cart</b>")}function o(){var t=JSON.parse(localStorage.getItem("favorites"));let a="";null!==t&&t.length>0?(t.map((function(t,e){let s=t.productId,i=t.image,o=t.title;o.length>25&&(o=o.slice(0,22)+"..."),a+='<div class="card product">                <div class="row g-0">                    <div class="col-md-4 product-image">                        <img src="'+i+'" class="img-fluid rounded-start lazy" alt="'+o+'"/>                    </div>                    <div class="col-md-8">                        <div class="card-body">                           <h4 class="card-title">'+o+' <span class="add-to-favorites" data-product-id="'+s+'" data-name="'+t.external+'" data-image="'+i+'"><img src="assets/images/heart.svg" alt="Add to favorites"></span></h4>                           <span class="w-100 remove-favorite" data-product-id="'+s+'">Remove</span>                        </div>                    </div>                </div>            </div>'})),$(".favorites-list").empty().append(a),$("#favoriteModal").modal("show")):(window.location.reload(),s("Error!","Please add a product to your favorites!"))}$.ajax({type:"GET",url:"https://www.cheapshark.com/api/1.0/stores",dataType:"json",success:function(t){t&&localStorage.setItem("stores",JSON.stringify(t))},error:function(t){console.log("-> err",t)}}),e(a.title,a.limit,a.page),$(document).on("click",".add-to-favorites",(function(){const t=$(this).attr("data-product-id"),a=$(this).attr("data-name"),e=$(this).attr("data-image");$(this).removeClass("add-to-favorites").addClass("favorited").empty().html('Added to favorites<img src="assets/images/heart.svg" alt="Add to favorites"/>'),function(t,a,e){let i=[];if(localStorage.getItem("favorites")&&(i=JSON.parse(localStorage.getItem("favorites"))),i.length>0){let o=[];i.map((function(a){a.productId!==t&&o.push(a.productId)})),o.includes(t)?(console.log("var"),s("Error","You already have this product in your favorites list!")):(console.log("ypok"),i.push({productId:t,title:a,image:e}),localStorage.setItem("favorites",JSON.stringify(i)),s("Success","Product added to favorites!"))}else i.push({productId:t,title:a,image:e}),localStorage.setItem("favorites",JSON.stringify(i)),s("Success","Product added to favorites!")}(t,a,e),setTimeout((function(){}),500)})),$(document).on("click",".quick-view",(function(){const t=$(this).attr("data-product-id");var a;a=t,$.ajax({type:"GET",url:"https://www.cheapshark.com/api/1.0/games?id="+a,dataType:"json",success:function(t){if(t){const e=JSON.parse(localStorage.getItem("stores")),s={weekday:"long",year:"numeric",month:"long",day:"numeric"},i={title:$(".gameModal .single-title"),image:$(".gameModal .product-image img"),cheapest:$(".gameModal .cheapest-modal span.date"),cheapestPrice:$(".gameModal .cheapest-modal span.price"),listGroup:$(".gameModal .list-group")};let o=t.info.title,d=t.info.thumb,c=t.cheapestPriceEver.price,r=t.cheapestPriceEver.date,l=t.deals;var a=new Date(1e3*r).toLocaleDateString("en-US",s);i.title.empty().append(o),i.cheapest.empty().append(a),i.cheapestPrice.empty().append("$"+c),i.image.attr("src",d);let n="";l.map((function(t,a){let s=t.storeID,i=t.dealID,c=t.price,r=t.retailPrice,l=t.savings;const p=e.map((t=>t.storeID)).indexOf(s);let m=e[p].storeName;n+='<a href="#" class="list-group-item list-group-item-action flex-column align-items-start">                            <div class="d-flex w-100 justify-content-between">                                <h5 class="mb-1">'+m+'</h5>                            </div>                           <div class="price-section">',n+=c===r?'<span class="sale-price">Price:$'+c+"</span> ":'<span class="normal-price">Sale Price:$'+r+'</span> <span class="sale-price">Price:$'+c+"</span> ",l>0&&(n+='<span class="savings">(You save %'+Number(l).toFixed(0)+")</span> "),n+='                           </div>                            <div class="mt-2">                             <button class="btn btn-outline-danger add-soft" data-image-src="'+d+'" data-name="'+o+'" data-price="'+c+'" data-id="'+i+'">Add to cart</button>                             </div>                        </a>'})),$(i.listGroup).empty().append(n)}},error:function(t){console.log("-> err",t)}}),setTimeout((function(){$("#gameModal").modal("show")}),500)})),$(document).on("click",".shopping-cart",(function(){i(),setTimeout((function(){$("#cartModal").modal("show")}),500)})),$(document).on("click",".remove-item",(function(){!function(t){if(!0===confirm("Are you sure you want to delete this product from your cart?")){let a=JSON.parse(localStorage.getItem("cart")).filter((a=>a.productId!==t));localStorage.setItem("cart",JSON.stringify(a)),i(),s("Success","Product removed from cart!"),$(".item-total-quantity").empty().append(a.length)}}($(this).attr("data-id"))})),$(document).on("click",".add-soft",(function(){const t=$(this).attr("data-id"),a=$(this).attr("data-image-src");!function(t,a,e,i){let o=[];localStorage.getItem("cart")&&(o=JSON.parse(localStorage.getItem("cart"))),o.push({productId:t,title:a,image:e,price:i}),localStorage.setItem("cart",JSON.stringify(o)),s("Success","Product added to cart!"),$(".item-total-quantity").empty().append(o.length)}(t,$(this).attr("data-name"),a,$(this).attr("data-price"))})),$(".btn-continue").click((function(){$("#cartModal").modal("hide")})),$(".close-game-modal").click((function(){$("#gameModal").modal("hide")})),$(".close-favorite-modal").click((function(){$("#gameModal").modal("hide")})),$(document).on("click",".remove-favorite",(function(){!function(t){if(!0===confirm("Are you sure you want to delete this product from your favorite item?")){let a=JSON.parse(localStorage.getItem("favorites")).filter((a=>a.productId!==t));localStorage.setItem("favorites",JSON.stringify(a)),o(),s("Success","Product removed from your favorites list!")}}($(this).attr("data-product-id"))})),$(document).on("click",".my-favorites,.favorited",(function(){o()})),$(window).scroll((function(){window.innerHeight+window.scrollY>=document.body.scrollHeight&&(a.page++,console.log("Next page"+a.page),e("batman",10,a.page))}))}));
